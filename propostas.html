<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Propostas Recebidas</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .aprovado { color: green; font-weight: bold; }
  </style>
</head>
<body class="bg-light">
  <div class="container mt-4">
    <h2 class="mb-3">Propostas Recebidas</h2>

    <div class="input-group mb-3">
      <input type="text" class="form-control" placeholder="Buscar por nome ou CNPJ" id="busca">
      <button class="btn btn-outline-secondary" onclick="filtrar()">Buscar</button>
    </div>

    <ul class="list-group" id="listaPropostas"></ul>
  </div>

  <script>
    const propostas = {
      "001": [
        { nome: "Empresa A", cnpj: "12.345.678/0001-00", valor: "R$ 18.000,00", status: "aprovado" },
        { nome: "Empresa B", cnpj: "98.765.432/0001-11", valor: "R$ 17.500,00", status: "pendente" },
        { nome: "Empresa C", cnpj: "11.222.333/0001-44", valor: "R$ 19.000,00", status: "pendente" }
      ]
    };

    function carregarPropostas() {
      const id = new URLSearchParams(window.location.search).get("id");
      const lista = document.getElementById("listaPropostas");
      const dados = propostas[id] || [];

      lista.innerHTML = dados.map((p, i) => `
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <div><strong>${p.nome}</strong> (${p.cnpj})</div>
            <div>Valor: ${p.valor}</div>
            <div>Status: ${p.status === 'aprovado' ? '<span class=\"aprovado\">Aprovado</span>' : 'Pendente'}</div>
          </div>
          <div>
            ${p.status === 'pendente' ? `
              <button class="btn btn-success btn-sm me-1" onclick="aprovar(${i}, '${id}')">Aprovar</button>
              <button class="btn btn-danger btn-sm" onclick="rejeitar(${i}, '${id}')">Rejeitar</button>
            ` : ''}
          </div>
        </li>
      `).join('');
    }

    function aprovar(index, id) {
      if (confirm("Deseja aprovar esta proposta?")) {
        propostas[id][index].status = 'aprovado';
        carregarPropostas();
      }
    }

    function rejeitar(index, id) {
      if (confirm("Tem certeza que deseja rejeitar esta proposta?")) {
        propostas[id].splice(index, 1);
        carregarPropostas();
      }
    }

    function filtrar() {
      const termo = document.getElementById("busca").value.toLowerCase();
      const id = new URLSearchParams(window.location.search).get("id");
      const lista = document.getElementById("listaPropostas");
      const dados = propostas[id] || [];

      const filtradas = dados.filter(p => p.nome.toLowerCase().includes(termo) || p.cnpj.includes(termo));

      lista.innerHTML = filtradas.map((p, i) => `
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <div><strong>${p.nome}</strong> (${p.cnpj})</div>
            <div>Valor: ${p.valor}</div>
            <div>Status: ${p.status === 'aprovado' ? '<span class=\"aprovado\">Aprovado</span>' : 'Pendente'}</div>
          </div>
          <div>
            ${p.status === 'pendente' ? `
              <button class="btn btn-success btn-sm me-1" onclick="aprovar(${i}, '${id}')">Aprovar</button>
              <button class="btn btn-danger btn-sm" onclick="rejeitar(${i}, '${id}')">Rejeitar</button>
            ` : ''}
          </div>
        </li>
      `).join('');
    }

    window.onload = carregarPropostas;
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>